<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Home Blinds - Sales Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }
        
        .header-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .logo {
            flex-shrink: 0;
        }
        
        .header-text {
            flex-grow: 1;
            min-width: 300px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        /* Tab Styles */
        .tabs-container {
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            padding: 0 20px;
            display: flex;
            overflow-x: auto;
        }
        
        .tab {
            background: transparent;
            border: none;
            padding: 18px 30px;
            font-size: 18px;
            font-weight: 700;
            color: #666;
            cursor: pointer;
            border-bottom: 4px solid transparent;
            transition: all 0.3s ease;
            white-space: nowrap;
            min-width: fit-content;
            letter-spacing: 0.5px;
        }
        
        .tab:hover {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            transform: translateY(-1px);
        }
        
        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background: white;
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
        }
        
        /* Sticky Filter Indicator */
        .sticky-filter-indicator {
            position: sticky;
            top: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 20px;
            z-index: 100;
            font-size: 14px;
            font-weight: 600;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: none;
        }
        
        .sticky-filter-indicator.visible {
            display: block;
        }
        
        .dashboard-content {
            padding: 30px;
        }
        
        .section {
            margin-bottom: 40px;
        }
        
        .section.compact-section {
            margin-bottom: 25px;
        }
        
        .section.compact-section h2 {
            font-size: 1.2em;
            margin-bottom: 8px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 4px;
        }
        
        /* Summary Section Styling */
        .section.summary-section {
            background: linear-gradient(135deg, #f8f9fc 0%, #e3f2fd 100%);
            border-radius: 12px;
            padding: 25px;
            margin: 20px -10px 30px -10px;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.1);
        }
        
        .section.summary-section h2 {
            color: #4a5568;
            margin-bottom: 15px;
            font-size: 1.6em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 8px;
        }
        
        .section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        
        .table-container {
            overflow-x: auto;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }
        
        th {
            background: #667eea;
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
        }
        
        tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        tr:hover {
            background: #e3f2fd;
        }
        
        .number {
            text-align: right;
            font-family: 'Courier New', monospace;
        }
        
        .positive {
            color: #28a745;
            font-weight: 600;
        }
        
        .negative {
            color: #dc3545;
            font-weight: 600;
        }
        
        .sales-rep-section {
            margin-bottom: 30px;
        }
        
        .sales-rep-header {
            background: #e9ecef;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 15px;
        }
        
        .sales-rep-header h3 {
            color: #495057;
            font-size: 1.4em;
        }
        
        .summary-cards {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .summary-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #667eea;
        }
        
        .summary-card.total-sales {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-left: 4px solid #fff;
            transform: scale(1.02);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        
        .summary-card.total-sales.excellent {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }
        
        .summary-card.total-sales.good {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
        }
        
        .summary-card.total-sales.warning {
            background: linear-gradient(135deg, #fd7e14 0%, #e55a4e 100%);
        }
        
        .summary-card.total-sales.poor {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }
        
        .summary-card.total-sales h3 {
            color: rgba(255, 255, 255, 0.9);
        }
        
        .summary-card.total-sales .value {
            color: white;
            font-size: 2.5em;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .summary-card.total-sales .value:hover {
            transform: scale(1.05);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .summary-card.secondary {
            padding: 15px;
        }
        
        .summary-card.secondary .value {
            font-size: 1.6em;
        }
        
        .summary-card.combined-metrics .value {
            font-size: 1em;
            line-height: 1.3;
        }
        
        .summary-card.discount-card .value {
            font-size: 1em;
            line-height: 1.2;
        }
        
        .summary-card h3 {
            color: #667eea;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }
        
        .summary-card .value {
            font-size: 2em;
            font-weight: bold;
            color: #333;
        }
        
        .loading {
            text-align: center;
            padding: 50px;
            color: #666;
            display: none;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 6px;
            margin: 20px 0;
            display: none;
        }
        
        .filters-container {
            display: flex;
            gap: 10px;
            align-items: end;
            background: #f8f9fa;
            padding: 10px 15px;
            border-radius: 6px;
            flex-wrap: wrap;
            border: 1px solid #e9ecef;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            min-width: 140px;
        }
        
        .filter-group label {
            font-weight: 500;
            color: #555;
            margin-bottom: 3px;
            font-size: 0.75em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .filter-group select {
            padding: 4px 8px;
            border: 1px solid #ced4da;
            border-radius: 3px;
            background: white;
            font-size: 12px;
            color: #333;
            height: 28px;
        }
        
        .filter-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 1px rgba(102, 126, 234, 0.2);
        }
        
        .clear-filters-btn {
            background: #6c757d;
            color: white;
            padding: 4px 10px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 11px;
            transition: background 0.3s ease;
            height: 28px;
        }
        
        .clear-filters-btn:hover {
            background: #5a6268;
        }
        
        .quick-filter-btn {
            background: #667eea;
            color: white;
            padding: 4px 10px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 11px;
            transition: background 0.3s ease;
            height: 28px;
        }
        
        .quick-filter-btn:hover {
            background: #5a67d8;
        }
        
        .quick-filter-btn:active {
            background: #4c51bf;
            transform: translateY(1px);
        }
        
        .filtered-info {
            background: #e3f2fd;
            color: #1565c0;
            padding: 10px 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            border-left: 4px solid #2196f3;
        }
        
        /* Clickable sales cells */
        .clickable-sales {
            cursor: pointer;
            color: #667eea;
            text-decoration: underline;
            transition: all 0.2s ease;
        }
        
        .clickable-sales:hover {
            background-color: #f0f4ff !important;
            color: #5a67d8;
            font-weight: 600;
        }
        
        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s ease;
        }
        
        .modal-content {
            background-color: white;
            margin: 2% auto;
            padding: 0;
            border-radius: 10px;
            width: 90%;
            max-width: 1000px;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.3s ease;
        }
        
        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h2 {
            margin: 0;
            font-size: 1.5em;
        }
        
        .modal-body {
            padding: 20px;
            max-height: 70vh;
            overflow-y: auto;
        }
        
        .close {
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: opacity 0.2s ease;
        }
        
        .close:hover {
            opacity: 0.7;
        }
        
        .order-summary {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        
        .order-summary-item {
            text-align: center;
        }
        
        .order-summary-item .label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }
        
        .order-summary-item .value {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
        }
        
        .orders-table {
            margin-top: 20px;
            overflow-x: auto;
        }
        
        .orders-table table {
            font-size: 0.9em;
            min-width: 700px;
        }
        
        #scrollHint {
            font-style: italic;
            text-align: center;
            background: #f8f9fa;
            padding: 8px;
            border-radius: 4px;
            border-left: 3px solid #667eea;
        }
        
        .orders-table th {
            background: #f8f9fa;
            color: #333;
            font-size: 0.85em;
        }
        
        /* Target Progress Styles */
        .targets-container {
            display: grid;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .target-progress-wrapper {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 30px;
            align-items: start;
        }
        
        .target-cards-container {
            display: grid;
            gap: 20px;
        }
        
        .speedometer-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-width: 200px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #667eea;
        }
        
        .speedometer-title {
            font-size: 0.9em;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .speedometer {
            position: relative;
            width: 160px;
            height: 80px;
            margin-bottom: 10px;
        }
        
        .speedometer-arc {
            stroke-width: 12;
            fill: none;
        }
        
        .speedometer-arc.behind {
            stroke: #dc3545;
        }
        
        .speedometer-arc.on-track {
            stroke: #ffc107;
        }
        
        .speedometer-arc.ahead {
            stroke: #28a745;
        }
        
        .speedometer-needle {
            stroke: #333;
            stroke-width: 3;
            stroke-linecap: round;
            transform-origin: 80px 70px;
            transition: transform 0.8s ease-in-out;
        }
        
        .speedometer-center {
            fill: #333;
        }
        
        .speedometer-labels {
            display: flex;
            justify-content: space-between;
            width: 160px;
            font-size: 0.7em;
            color: #666;
            font-weight: 500;
        }
        
        .speedometer-status {
            font-size: 0.85em;
            font-weight: 600;
            margin-top: 8px;
            padding: 4px 8px;
            border-radius: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .speedometer-status.behind {
            background: rgba(220, 53, 69, 0.1);
            color: #dc3545;
        }
        
        .speedometer-status.on-track {
            background: rgba(255, 193, 7, 0.1);
            color: #856404;
        }
        
        .speedometer-status.ahead {
            background: rgba(40, 167, 69, 0.1);
            color: #28a745;
        }
        
        .target-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #667eea;
        }
        
        .target-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .target-header h3 {
            color: #333;
            margin: 0;
            font-size: 1.2em;
        }
        
        .target-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .target-metric {
            text-align: center;
        }
        
        .target-metric .label {
            font-size: 0.8em;
            color: #666;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .target-metric .value {
            font-size: 1.1em;
            font-weight: bold;
            color: #333;
        }
        
        .target-metric .value.positive {
            color: #28a745;
        }
        
        .target-metric .value.negative {
            color: #dc3545;
        }
        
        .progress-bar-container {
            background: #e9ecef;
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
            margin-bottom: 10px;
            position: relative;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            transition: width 0.5s ease;
            position: relative;
        }
        
        .progress-bar.behind {
            background: linear-gradient(90deg, #dc3545, #e74c3c);
        }
        
        .progress-bar.ahead {
            background: linear-gradient(90deg, #007bff, #0056b3);
        }
        
        .time-progress-indicator {
            position: absolute;
            top: 0;
            height: 100%;
            width: 2px;
            background: #333;
            z-index: 10;
            transition: left 0.5s ease;
        }
        
        .time-progress-indicator::before {
            content: '';
            position: absolute;
            top: -4px;
            left: -3px;
            width: 8px;
            height: 8px;
            background: #333;
            border-radius: 50%;
        }
        
        .time-progress-indicator::after {
            content: 'Expected';
            position: absolute;
            top: -25px;
            left: -20px;
            font-size: 9px;
            color: #333;
            font-weight: 600;
            white-space: nowrap;
        }
        
        .progress-text {
            text-align: center;
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }
        
        .team-summary {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            border-left: 4px solid #28a745;
        }
        
        .team-summary h4 {
            color: #333;
            margin: 0 0 15px 0;
            font-size: 1.1em;
        }
        
        /* Variance Equation Styles */
        .variance-equation-container {
            background: white;
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        .variance-equation {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            margin: 15px 0;
            font-size: 16px;
            font-weight: 600;
        }
        
        .equation-term {
            display: flex;
            align-items: center;
            white-space: nowrap;
        }
        
        .equation-term.previous {
            color: #6c757d;
        }
        
        .equation-term.operator {
            font-size: 20px;
            color: #333;
            margin: 0 5px;
        }
        
        .equation-term.positive {
            color: #28a745;
        }
        
        .equation-term.negative {
            color: #dc3545;
        }
        
        .equation-term.current {
            color: #667eea;
            font-weight: 700;
        }
        
        .equation-term.equals {
            font-size: 24px;
            color: #333;
            margin: 0 10px;
        }
        
        .equation-label {
            font-size: 12px;
            color: #666;
            font-weight: normal;
            display: block;
            margin-top: 4px;
            text-align: center;
        }
        
        /* Hidden section style */
        .section.hidden {
            display: none;
        }
        
        /* Current Period Heading Styling */
        #currentPeriodHeading {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 25px;
            margin: 0 -30px 20px -30px;
            border-radius: 0;
            border: none;
            font-size: 2.2em;
            font-weight: 700;
            text-align: center;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
            letter-spacing: 0.5px;
        }
        
        /* Chart Styling */
        .chart-container {
            background: white;
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
        }
        
        .chart-wrapper {
            position: relative;
            height: 300px;
            display: flex;
            flex-direction: column;
        }
        
        .chart-bars {
            display: flex;
            align-items: flex-end;
            height: 250px;
            gap: 15px;
            padding: 0 10px;
            justify-content: space-between;
        }
        
        .chart-bar {
            flex: 1;
            background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
            border-radius: 6px 6px 0 0;
            min-height: 5px;
            position: relative;
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .chart-bar:hover {
            background: linear-gradient(180deg, #5a67d8 0%, #6b46c1 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        
        .chart-bar.current-month {
            background: linear-gradient(180deg, #28a745 0%, #20c997 100%);
        }
        
        .chart-bar.current-month:hover {
            background: linear-gradient(180deg, #218838 0%, #1e7e34 100%);
        }
        
        .chart-bar-value {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 11px;
            font-weight: 600;
            color: #333;
            white-space: nowrap;
            background: rgba(255, 255, 255, 0.9);
            padding: 2px 6px;
            border-radius: 3px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .chart-labels {
            display: flex;
            gap: 15px;
            padding: 15px 10px 0;
            justify-content: space-between;
        }
        
        .chart-label {
            flex: 1;
            text-align: center;
            font-size: 12px;
            color: #666;
            font-weight: 500;
        }
        
        .chart-label.current {
            color: #28a745;
            font-weight: 700;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .dashboard-content {
                padding: 15px;
            }
            
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            .header-text {
                min-width: auto;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .header p {
                font-size: 1em;
            }
            
            .tabs-container {
                padding: 0 10px;
            }
            
            .tab {
                padding: 12px 15px;
                font-size: 14px;
            }
            
            .summary-cards {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .summary-card.total-sales {
                transform: none;
            }
            
            .summary-card.total-sales .value {
                font-size: 2em;
            }
            
            .summary-card.secondary .value {
                font-size: 1.4em;
            }
            
            .summary-card.combined-metrics .value {
                font-size: 0.9em;
            }
            
            .summary-card.discount-card .value {
                font-size: 0.9em;
            }
            
            #currentPeriodHeading {
                margin: 0 -15px 15px -15px;
                font-size: 1.8em;
                padding: 15px 20px;
            }
            
            .chart-container {
                padding: 15px;
                margin-top: 15px;
            }
            
            .chart-wrapper {
                height: 250px;
            }
            
            .chart-bars {
                height: 200px;
                gap: 8px;
            }
            
            .chart-bar-value {
                font-size: 10px;
                top: -22px;
            }
            
            .chart-labels {
                gap: 8px;
                padding-top: 10px;
            }
            
            .chart-label {
                font-size: 11px;
            }
            
            .summary-card {
                padding: 15px;
            }
            
            .summary-card .value {
                font-size: 1.5em;
            }
            
            .summary-card.combined-metrics .value {
                font-size: 0.85em;
            }
            
            .summary-card.discount-card .value {
                font-size: 0.85em;
            }
            
            table {
                font-size: 0.8em;
            }
            
            th, td {
                padding: 8px 6px;
            }
            
            .filters-container {
                flex-direction: column;
                gap: 15px;
                padding: 15px;
            }
            
            .filter-group {
                min-width: 100%;
            }
            
            .filter-group div {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .quick-filter-btn,
            .clear-filters-btn {
                font-size: 13px;
                padding: 7px 12px;
            }
            
            .target-metrics {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
            
            .target-metric .value {
                font-size: 1em;
            }
            
            .target-progress-wrapper {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .speedometer-container {
                min-width: auto;
                width: 100%;
                max-width: 300px;
                margin: 0 auto;
            }
            
            .order-summary {
                grid-template-columns: 1fr;
                gap: 10px;
                padding: 12px;
            }
            
            .order-summary-item .value {
                font-size: 1.1em;
            }
            
            .variance-equation {
                flex-direction: column;
                gap: 10px;
                padding: 15px;
                font-size: 14px;
            }
            
            .equation-term {
                justify-content: center;
                text-align: center;
            }
            
            .equation-term.operator,
            .equation-term.equals {
                font-size: 18px;
            }
            
            .equation-label {
                font-size: 11px;
            }
            
            /* Mobile Modal Improvements */
            .modal-content {
                width: 95%;
                margin: 5% auto;
                max-height: 85vh;
            }
            
            .modal-header {
                padding: 15px;
            }
            
            .modal-header h2 {
                font-size: 1.2em;
            }
            
            .modal-body {
                padding: 15px;
                max-height: 65vh;
            }
            
            .orders-table table {
                font-size: 0.75em;
                min-width: 600px;
            }
            
            .orders-table th,
            .orders-table td {
                padding: 6px 4px;
            }
            
            .close {
                font-size: 24px;
            }
        }
        
        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.5em;
            }
            
            .header-content {
                gap: 10px;
            }
            
            .section h2 {
                font-size: 1.4em;
            }
            
            .tab {
                padding: 12px 15px;
                font-size: 14px;
                font-weight: 600;
            }
            
            .summary-cards {
                grid-template-columns: 1fr;
            }
            
            .target-metrics {
                grid-template-columns: 1fr;
            }
            
            .speedometer-container {
                padding: 15px;
            }
            
            .speedometer-labels {
                font-size: 0.65em;
            }
            
            #currentPeriodHeading {
                font-size: 1.5em;
                padding: 12px 15px;
            }
            
            .chart-container {
                padding: 12px;
            }
            
            .chart-wrapper {
                height: 200px;
            }
            
            .chart-bars {
                height: 160px;
                gap: 6px;
            }
            
            .chart-bar-value {
                font-size: 9px;
                top: -20px;
                padding: 1px 4px;
            }
            
            .chart-labels {
                gap: 6px;
                padding-top: 8px;
            }
            
            .chart-label {
                font-size: 10px;
            }
            
            .modal-content {
                margin: 2% auto;
                max-height: 90vh;
            }
            
            .orders-table table {
                min-width: 550px;
            }
            
            .variance-equation-container {
                padding: 15px;
            }
            
            .variance-equation {
                font-size: 12px;
                padding: 12px;
                gap: 8px;
            }
            
            .equation-term.operator,
            .equation-term.equals {
                font-size: 16px;
            }
            
            .equation-label {
                font-size: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-content">
                <div class="logo">
                    <img src="logo.png" alt="New Home Blinds Logo" style="height: 60px; width: auto;">
                </div>
                <div class="header-text">
                    <h1>New Home Blinds - Sales Dashboard</h1>
                </div>
            </div>
        </div>
        
        <!-- Tabs Section -->
        <div class="tabs-container">
            <button class="tab active" onclick="switchTab('team')">Team Total</button>
            <button class="tab" onclick="switchTab('Michael Bell')">Michael Bell</button>
            <button class="tab" onclick="switchTab('Ria Wise')">Ria Wise</button>
        </div>
        
        <!-- Sticky Filter Indicator -->
        <div class="sticky-filter-indicator" id="stickyIndicator">
            <span id="stickyIndicatorText">Team Total - All Data</span>
        </div>
        
        <div class="dashboard-content">
            <div class="loading" id="loading">
                <h3>Loading dashboard data...</h3>
            </div>
            
            <div class="error" id="error"></div>
            
            <div id="dashboardResults" style="display: none;">
                <!-- Filters Section -->
                <div class="section compact-section">
                    <h2>Filters</h2>
                    <div class="filters-container">
                        <div class="filter-group">
                            <label for="fyFilter">Financial Year:</label>
                            <select id="fyFilter" onchange="onFYFilterChange()">
                                <option value="">All Financial Years</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="monthFilter">Month:</label>
                            <select id="monthFilter" onchange="applyFilters()">
                                <option value="">All Months</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>&nbsp;</label> <!-- Spacer for alignment -->
                            <div style="display: flex; gap: 8px;">
                                <button class="quick-filter-btn" onclick="setCurrentMonth()" title="View current month data">Current Month</button>
                                <button class="quick-filter-btn" onclick="setPreviousMonth()" title="View previous month data">Previous Month</button>
                                <button class="clear-filters-btn" onclick="clearFilters()">Clear All</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Current Period Heading -->
                <div class="section">
                    <h2 id="currentPeriodHeading">Loading...</h2>
                </div>
                
                <!-- Summary Cards -->
                <div class="section summary-section">
                    <h2>Summary</h2>
                    <p style="color: #666; margin-bottom: 15px; font-style: italic;">
                        ðŸ’¡ Click on Total Sales to view all order details
                    </p>
                    <div class="summary-cards" id="summaryCards"></div>
                </div>
                
                <!-- Half-Year Targets Progress -->
                <div class="section" id="targetProgressSection">
                    <h2>Half-Year Target Progress (July - December 2025)</h2>
                    <div id="targetsProgress"></div>
                </div>
                
                <!-- Sales Performance Table -->
                <div class="section">
                    <h2>Monthly Sales Performance by Rep</h2>
                    <p style="color: #666; margin-bottom: 15px; font-style: italic;">
                        ðŸ’¡ Click on any sales total to view individual orders
                    </p>
                    <div class="table-container">
                        <table id="performanceTable">
                            <thead>
                                <tr>
                                    <th>Sales Rep</th>
                                    <th>Month</th>
                                    <th class="number">Total Sales (Â£)</th>
                                    <th class="number">Number of Orders</th>
                                    <th class="number">Average Order Value (Â£)</th>
                                </tr>
                            </thead>
                            <tbody id="performanceTableBody"></tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Variance Analysis -->
                <div class="section">
                    <h2>Month-on-Month Variance Analysis</h2>
                    <div id="waterfallChartsContainer"></div>
                    <div class="table-container">
                        <table id="varianceTable">
                            <thead>
                                <tr>
                                    <th>Sales Rep</th>
                                    <th>Current Month</th>
                                    <th>Previous Month</th>
                                    <th class="number">Total Sales Variance (Â£)</th>
                                    <th class="number">Order Count Variance</th>
                                    <th class="number">Avg Order Value Variance (Â£)</th>
                                    <th class="number">Variance Due to Order Count (Â£)</th>
                                    <th class="number">Variance Due to Avg Order Value (Â£)</th>
                                </tr>
                            </thead>
                            <tbody id="varianceTableBody"></tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Rolling 6-Month Sales Chart -->
                <div class="section">
                    <h2 id="chartTitle">Rolling 6-Month Sales Trend</h2>
                    <div class="chart-container">
                        <div class="chart-wrapper">
                            <div class="chart-bars" id="chartBars"></div>
                            <div class="chart-labels" id="chartLabels"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Order Details Modal -->
    <div id="orderModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Order Details</h2>
                <span class="close" onclick="closeOrderModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="order-summary" id="orderSummary">
                    <!-- Summary cards will be inserted here -->
                </div>
                <div class="orders-table">
                    <p style="color: #666; margin-bottom: 10px; font-size: 0.85em; display: none;" id="scrollHint">
                        ðŸ“± Scroll horizontally to view all columns
                    </p>
                    <table>
                        <thead>
                            <tr>
                                <th>Invoice No.</th>
                                <th>Date</th>
                                <th>Customer</th>
                                <th>Product/Service</th>
                                <th>Line Description</th>
                                <th class="number">Amount (Â£)</th>
                                <th>Type</th>
                            </tr>
                        </thead>
                        <tbody id="orderDetailsBody">
                            <!-- Order details will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        let dashboardData = null;
        let filteredData = null;
        let rawTransactionData = []; // Store original transaction data for drill-down
        let currentTab = 'team'; // Track current tab
        
        // Half-year targets (July - December 2025)
        const halfYearTargets = {
            "Michael Bell": 90000,
            "Ria Wise": 132000,
            period: "July - December 2025",
            startMonth: "2025-07",
            endMonth: "2025-12"
        };
        
        // Monthly targets for conditional coloring
        const monthlyTargets = {
            "Ria Wise": {
                "2025-07": 21400,
                "2025-08": 22600,
                "2025-09": 22600,
                "2025-10": 24300,
                "2025-11": 24300,
                "2025-12": 16900
            },
            "Michael Bell": {
                "2025-07": 13200,
                "2025-08": 14300,
                "2025-09": 15400,
                "2025-10": 16500,
                "2025-11": 17600,
                "2025-12": 13200
            }
        };
        
        function getMonthlyTarget(salesRep, month) {
            if (salesRep === 'team') {
                // Calculate team target as sum of individual targets
                const riaTarget = monthlyTargets["Ria Wise"][month] || 0;
                const michaelTarget = monthlyTargets["Michael Bell"][month] || 0;
                return riaTarget + michaelTarget;
            }
            
            return monthlyTargets[salesRep] ? (monthlyTargets[salesRep][month] || 0) : 0;
        }
        
        function getPerformanceStatus(actualSales, target) {
            if (target === 0) return 'default';
            
            const performanceRatio = actualSales / target;
            
            if (performanceRatio >= 1.0) {
                return 'excellent'; // At or above target
            } else if (performanceRatio >= 0.8) {
                return 'good'; // 80-99% of target
            } else if (performanceRatio >= 0.6) {
                return 'warning'; // 60-79% of target
            } else {
                return 'poor'; // Below 60% of target
            }
        }
        
        // Sticky indicator functionality
        function updateStickyIndicator() {
            const fyFilter = document.getElementById('fyFilter').value;
            const monthFilter = document.getElementById('monthFilter').value;
            
            let indicatorText = currentTab === 'team' ? 'Team Total' : currentTab;
            
            if (monthFilter) {
                indicatorText += ` - ${formatMonth(monthFilter)}`;
            } else if (fyFilter) {
                indicatorText += ` - ${fyFilter}`;
            } else {
                indicatorText += ' - All Data';
            }
            
            document.getElementById('stickyIndicatorText').textContent = indicatorText;
        }
        
        // Show/hide sticky indicator based on scroll position
        window.addEventListener('scroll', function() {
            const tabsContainer = document.querySelector('.tabs-container');
            const stickyIndicator = document.getElementById('stickyIndicator');
            const tabsRect = tabsContainer.getBoundingClientRect();
            
            if (tabsRect.bottom < 0) {
                stickyIndicator.classList.add('visible');
            } else {
                stickyIndicator.classList.remove('visible');
            }
        });
        
        // Function to check if we should show target progress
        function shouldShowTargetProgress(summaryData) {
            const targetStartMonth = halfYearTargets.startMonth;
            const targetEndMonth = halfYearTargets.endMonth;
            
            // Check if current filters intersect with target period
            const fyFilter = document.getElementById('fyFilter').value;
            const monthFilter = document.getElementById('monthFilter').value;
            
            // If specific month is selected, check if it's in target period
            if (monthFilter) {
                return monthFilter >= targetStartMonth && monthFilter <= targetEndMonth;
            }
            
            // If specific FY is selected, check if it includes target period
            if (fyFilter) {
                // Get all months in the selected FY from the data
                const fyMonths = dashboardData.summaryData
                    .filter(item => item.financialYear === fyFilter)
                    .map(item => item.month);
                const uniqueFyMonths = [...new Set(fyMonths)].sort();
                
                // Check if any month in the FY intersects with target period
                return uniqueFyMonths.some(month => 
                    month >= targetStartMonth && month <= targetEndMonth
                );
            }
            
            // No filters - check if data contains target period
            return summaryData.some(item => 
                item.month >= targetStartMonth && item.month <= targetEndMonth
            );
        }
        
        // Tab switching function
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update current tab
            currentTab = tabName;
            
            // Apply filters with new tab
            applyFilters();
        }
        
        // Get current date and calculate defaults
        function getCurrentDefaults() {
            const now = new Date();
            const currentMonth = now.getMonth() + 1; // 1-based month
            const currentYear = now.getFullYear();
            const currentMonthYear = `${currentYear}-${String(currentMonth).padStart(2, '0')}`;
            const currentFY = getFinancialYear(now);
            
            return {
                currentMonthYear: currentMonthYear,
                currentFY: currentFY
            };
        }
        
        function parseAndProcessData(csvData) {
            // Check if Papa Parse is loaded
            if (typeof Papa === 'undefined') {
                throw new Error('Papa Parse library is not available. Please refresh the page and try again.');
            }
            
            // Skip header rows and parse CSV
            const lines = csvData.split('\n');
            const dataLines = lines.slice(4); // Skip first 4 header lines
            const dataContent = dataLines.join('\n');
            
            const parsed = Papa.parse(dataContent, {
                header: true,
                dynamicTyping: true,
                skipEmptyLines: true
            });
            
            // Clean and process data
            const cleanData = parsed.data.filter(row => 
                row['Sales Rep'] && 
                row['Transaction date'] && 
                row['No.'] && 
                row['Amount'] !== null && 
                row['Amount'] !== undefined
            );
            
            const processedData = cleanData.map(row => {
                let amount = row['Amount'];
                if (typeof amount === 'string') {
                    amount = parseFloat(amount.replace(/,/g, ''));
                }
                
                const date = parseDate(row['Transaction date']);
                return {
                    ...row,
                    Amount: amount,
                    Month: date.getMonth() + 1,
                    Year: date.getFullYear(),
                    MonthYear: `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`,
                    FinancialYear: getFinancialYear(date)
                };
            });
            
            // Store raw transaction data globally for drill-down
            rawTransactionData = processedData;
            
            // Add financial year info to processed data
            const dataWithFY = processedData;
            
            // Get unique values
            const uniqueMonths = [...new Set(dataWithFY.map(row => row.MonthYear))].sort();
            const uniqueSalesReps = [...new Set(dataWithFY.map(row => row['Sales Rep']))].sort();
            const uniqueFYs = [...new Set(dataWithFY.map(row => row.FinancialYear))].sort();
            
            // Calculate summary data
            const summaryData = [];
            uniqueSalesReps.forEach(rep => {
                uniqueMonths.forEach(month => {
                    const monthData = dataWithFY.filter(row => 
                        row['Sales Rep'] === rep && row.MonthYear === month
                    );
                    
                    if (monthData.length > 0) {
                        const totalSales = _.sumBy(monthData, 'Amount');
                        const uniqueInvoices = [...new Set(monthData.map(row => row['No.']))];
                        const orderCount = uniqueInvoices.length;
                        const avgOrderValue = totalSales / orderCount;
                        
                        summaryData.push({
                            salesRep: rep,
                            month: month,
                            financialYear: monthData[0].FinancialYear,
                            totalSales: Math.round(totalSales * 100) / 100,
                            orderCount: orderCount,
                            avgOrderValue: Math.round(avgOrderValue * 100) / 100
                        });
                    }
                });
            });
            
            // Calculate variance analysis
            const varianceData = [];
            uniqueSalesReps.forEach(rep => {
                const repData = summaryData.filter(s => s.salesRep === rep).sort((a, b) => a.month.localeCompare(b.month));
                
                for (let i = 1; i < repData.length; i++) {
                    const current = repData[i];
                    const previous = repData[i - 1];
                    
                    const totalSalesVariance = current.totalSales - previous.totalSales;
                    const orderCountVariance = current.orderCount - previous.orderCount;
                    const avgOrderValueVariance = current.avgOrderValue - previous.avgOrderValue;
                    
                    const varianceDueToOrderCount = orderCountVariance * previous.avgOrderValue;
                    const varianceDueToAvgOrderValue = current.orderCount * avgOrderValueVariance;
                    
                    varianceData.push({
                        salesRep: rep,
                        currentMonth: current.month,
                        previousMonth: previous.month,
                        totalSalesVariance: Math.round(totalSalesVariance * 100) / 100,
                        orderCountVariance: orderCountVariance,
                        avgOrderValueVariance: Math.round(avgOrderValueVariance * 100) / 100,
                        varianceDueToOrderCount: Math.round(varianceDueToOrderCount * 100) / 100,
                        varianceDueToAvgOrderValue: Math.round(varianceDueToAvgOrderValue * 100) / 100,
                        previousTotalSales: previous.totalSales,
                        currentTotalSales: current.totalSales
                    });
                }
            });
            
            return {
                summaryData: summaryData,
                varianceData: varianceData,
                uniqueMonths: uniqueMonths,
                uniqueSalesReps: uniqueSalesReps,
                uniqueFYs: uniqueFYs
            };
        }
        
        function parseDate(dateStr) {
            const [day, month, year] = dateStr.split('/');
            return new Date(year, month - 1, day);
        }
        
        function getFinancialYear(date) {
            const year = date.getFullYear();
            const month = date.getMonth(); // 0-based (0 = January)
            
            if (month >= 6) { // July onwards (month 6+)
                return `FY${year.toString().slice(-2)}/${(year + 1).toString().slice(-2)}`;
            } else { // January to June
                return `FY${(year - 1).toString().slice(-2)}/${year.toString().slice(-2)}`;
            }
        }
        
        function isDateInFY(date, fy) {
            if (!fy) return true; // No FY filter
            
            const year = date.getFullYear();
            const month = date.getMonth();
            
            // Extract years from FY string (e.g., "FY24/25" -> [2024, 2025])
            const fyMatch = fy.match(/FY(\d{2})\/(\d{2})/);
            if (!fyMatch) return true;
            
            const fyStartYear = 2000 + parseInt(fyMatch[1]);
            const fyEndYear = 2000 + parseInt(fyMatch[2]);
            
            // Check if date falls within the financial year
            if (year === fyStartYear && month >= 6) return true; // July onwards in start year
            if (year === fyEndYear && month < 6) return true; // January to June in end year
            
            return false;
        }
        
        function formatMonth(monthStr) {
            const [year, month] = monthStr.split('-');
            const date = new Date(year, month - 1);
            return date.toLocaleDateString('en-GB', { year: 'numeric', month: 'long' });
        }
        
        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-GB', {
                style: 'currency',
                currency: 'GBP'
            }).format(amount);
        }
        
        function createVarianceEquation(varianceRow) {
            const container = document.createElement('div');
            container.className = 'variance-equation-container';
            
            const previousSales = varianceRow.previousTotalSales;
            const orderCountImpact = varianceRow.varianceDueToOrderCount;
            const avgOrderValueImpact = varianceRow.varianceDueToAvgOrderValue;
            const currentSales = varianceRow.currentTotalSales;
            
            const orderCountClass = orderCountImpact >= 0 ? 'positive' : 'negative';
            const avgOrderValueClass = avgOrderValueImpact >= 0 ? 'positive' : 'negative';
            
            const orderCountOperator = orderCountImpact >= 0 ? '+' : '';
            const avgOrderValueOperator = avgOrderValueImpact >= 0 ? '+' : '';
            
            container.innerHTML = `
                <h4 style="margin-bottom: 15px; color: #333;">${varianceRow.salesRep}: ${formatMonth(varianceRow.previousMonth)} â†’ ${formatMonth(varianceRow.currentMonth)}</h4>
                <div class="variance-equation">
                    <div class="equation-term previous">
                        ${formatCurrency(previousSales)}
                        <span class="equation-label">Previous Month</span>
                    </div>
                    
                    <div class="equation-term operator">+</div>
                    
                    <div class="equation-term ${orderCountClass}">
                        ${orderCountOperator}${formatCurrency(orderCountImpact)}
                        <span class="equation-label">Order Count Impact</span>
                    </div>
                    
                    <div class="equation-term operator">+</div>
                    
                    <div class="equation-term ${avgOrderValueClass}">
                        ${avgOrderValueOperator}${formatCurrency(avgOrderValueImpact)}
                        <span class="equation-label">Avg Order Value Impact</span>
                    </div>
                    
                    <div class="equation-term equals">=</div>
                    
                    <div class="equation-term current">
                        ${formatCurrency(currentSales)}
                        <span class="equation-label">Current Month</span>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 10px; font-size: 14px; color: #666;">
                    <strong>Total Variance: ${varianceRow.totalSalesVariance >= 0 ? '+' : ''}${formatCurrency(varianceRow.totalSalesVariance)}</strong>
                </div>
            `;
            
            return container;
        }
        
        function showOrderDetails(salesRep, month) {
            // Filter raw data for the selected sales rep and month
            const orderData = rawTransactionData.filter(row => 
                row['Sales Rep'] === salesRep && row.MonthYear === month
            );
            
            // Group by invoice number to organize the display
            const ordersByInvoice = _.groupBy(orderData, 'No.');
            
            // Calculate summary for the modal header
            const totalSales = _.sumBy(orderData, 'Amount');
            const uniqueInvoices = Object.keys(ordersByInvoice);
            const orderCount = uniqueInvoices.length;
            const avgOrderValue = totalSales / orderCount;
            
            // Update modal title
            document.getElementById('modalTitle').textContent = 
                `Orders: ${salesRep} - ${formatMonth(month)}`;
            
            populateOrderModal(orderData, ordersByInvoice, totalSales, orderCount, avgOrderValue);
        }
        
        function showSummaryOrderDetails() {
            // Get current filter values
            const fyFilter = document.getElementById('fyFilter').value;
            const monthFilter = document.getElementById('monthFilter').value;
            
            // Filter raw data based on current filters
            let orderData = rawTransactionData;
            
            // Apply tab filter (sales rep)
            if (currentTab !== 'team') {
                orderData = orderData.filter(row => row['Sales Rep'] === currentTab);
            }
            
            // Apply financial year filter
            if (fyFilter) {
                orderData = orderData.filter(row => row.FinancialYear === fyFilter);
            }
            
            // Apply month filter
            if (monthFilter) {
                orderData = orderData.filter(row => row.MonthYear === monthFilter);
            }
            
            // Group by invoice number to organize the display
            const ordersByInvoice = _.groupBy(orderData, 'No.');
            
            // Calculate summary for the modal header
            const totalSales = _.sumBy(orderData, 'Amount');
            const uniqueInvoices = Object.keys(ordersByInvoice);
            const orderCount = uniqueInvoices.length;
            const avgOrderValue = orderCount > 0 ? totalSales / orderCount : 0;
            
            // Create modal title based on current filters
            let modalTitle = 'All Orders';
            if (currentTab !== 'team' && monthFilter) {
                modalTitle = `Orders: ${currentTab} - ${formatMonth(monthFilter)}`;
            } else if (currentTab !== 'team') {
                modalTitle = `All Orders: ${currentTab}`;
            } else if (monthFilter) {
                modalTitle = `All Orders - ${formatMonth(monthFilter)}`;
            } else if (fyFilter) {
                modalTitle = `All Orders - ${fyFilter}`;
            }
            
            // Update modal title
            document.getElementById('modalTitle').textContent = modalTitle;
            
            populateOrderModal(orderData, ordersByInvoice, totalSales, orderCount, avgOrderValue);
        }
        
        function populateOrderModal(orderData, ordersByInvoice, totalSales, orderCount, avgOrderValue) {
            // Create summary cards
            const summaryContainer = document.getElementById('orderSummary');
            summaryContainer.innerHTML = `
                <div class="order-summary-item">
                    <div class="label">Total Sales</div>
                    <div class="value">${formatCurrency(totalSales)}</div>
                </div>
                <div class="order-summary-item">
                    <div class="label">Number of Orders</div>
                    <div class="value">${orderCount}</div>
                </div>
                <div class="order-summary-item">
                    <div class="label">Average Order Value</div>
                    <div class="value">${formatCurrency(avgOrderValue)}</div>
                </div>
            `;
            
            // Populate order details table with individual line items
            const tbody = document.getElementById('orderDetailsBody');
            tbody.innerHTML = '';
            
            if (orderCount === 0) {
                const tr = document.createElement('tr');
                tr.innerHTML = '<td colspan="7" style="text-align: center; color: #666; padding: 30px;">No orders found for the selected criteria</td>';
                tbody.appendChild(tr);
            } else {
                // Sort invoices by date (using the first transaction date in each invoice)
                const sortedInvoices = Object.keys(ordersByInvoice).sort((a, b) => {
                    const dateA = parseDate(ordersByInvoice[a][0]['Transaction date']);
                    const dateB = parseDate(ordersByInvoice[b][0]['Transaction date']);
                    return dateB - dateA; // Most recent first
                });
                
                // Display all line items grouped by invoice
                sortedInvoices.forEach(invoiceNo => {
                    const invoiceItems = ordersByInvoice[invoiceNo];
                    
                    // Sort items within invoice by any natural order (keeping original order)
                    invoiceItems.forEach((item, index) => {
                        const tr = document.createElement('tr');
                        
                        // Add visual grouping - show invoice number only on first item
                        const displayInvoiceNo = index === 0 ? invoiceNo : '';
                        const displayDate = index === 0 ? item['Transaction date'] : '';
                        const displayCustomer = index === 0 ? (item['Customer'] || 'N/A') : '';
                        
                        // Get Product/Service and Line Description from CSV
                        // Try multiple possible column name variations
                        const productService = item['Product/Service'] || item['Product'] || item['Service'] || 'N/A';
                        const lineDescription = item['Line Description'] || item['Line description'] || item['Description'] || item['line description'] || 'N/A';
                        
                        tr.innerHTML = `
                            <td style="font-weight: ${index === 0 ? 'bold' : 'normal'};">${displayInvoiceNo}</td>
                            <td>${displayDate}</td>
                            <td>${displayCustomer}</td>
                            <td>${productService}</td>
                            <td>${lineDescription}</td>
                            <td class="number">${formatCurrency(item.Amount)}</td>
                            <td>${item['Type'] || 'Invoice'}</td>
                        `;
                        
                        // Add subtle border between invoices
                        if (index === 0 && tbody.children.length > 0) {
                            tr.style.borderTop = '2px solid #dee2e6';
                        }
                        
                        tbody.appendChild(tr);
                    });
                });
            }
            
            // Show scroll hint on mobile devices
            const scrollHint = document.getElementById('scrollHint');
            if (window.innerWidth <= 768) {
                scrollHint.style.display = 'block';
            } else {
                scrollHint.style.display = 'none';
            }
            
            // Show modal
            document.getElementById('orderModal').style.display = 'block';
        }
        
        function closeOrderModal() {
            document.getElementById('orderModal').style.display = 'none';
        }
        
        // Close modal when clicking outside of it
        window.onclick = function(event) {
            const modal = document.getElementById('orderModal');
            if (event.target === modal) {
                closeOrderModal();
            }
        };
        
        // Close modal with Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeOrderModal();
            }
        });
        
        function calculateTargetProgress(summaryData) {
            const targetPeriodStart = halfYearTargets.startMonth;
            const targetPeriodEnd = halfYearTargets.endMonth;
            
            // Get current date info
            const now = new Date();
            const currentMonthYear = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;
            
            // Calculate months elapsed and remaining in target period
            const startDate = new Date(targetPeriodStart + '-01');
            const endDate = new Date(targetPeriodEnd + '-01');
            const actualCurrentDate = new Date(); // Use actual current date, not month filter
            
            let monthsElapsed = 0;
            let totalMonths = 0;
            let monthsRemaining = 0;
            
            // Calculate total months in period
            let tempDate = new Date(startDate);
            while (tempDate <= endDate) {
                totalMonths++;
                tempDate.setMonth(tempDate.getMonth() + 1);
            }
            
            // Calculate actual time elapsed and remaining
            if (actualCurrentDate >= startDate && actualCurrentDate <= endDate) {
                // We're within the target period - calculate fractional months
                const currentMonth = actualCurrentDate.getMonth();
                const currentYear = actualCurrentDate.getFullYear();
                const currentDay = actualCurrentDate.getDate();
                
                // Count complete months elapsed
                tempDate = new Date(startDate);
                while (tempDate.getFullYear() < currentYear || 
                       (tempDate.getFullYear() === currentYear && tempDate.getMonth() < currentMonth)) {
                    if (tempDate <= endDate) {
                        monthsElapsed++;
                    }
                    tempDate.setMonth(tempDate.getMonth() + 1);
                }
                
                // Add fraction of current month elapsed
                const daysInCurrentMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
                const fractionOfCurrentMonthElapsed = (currentDay - 1) / daysInCurrentMonth; // -1 because day 1 = start of month
                monthsElapsed += fractionOfCurrentMonthElapsed;
                
                // Calculate remaining time
                monthsRemaining = Math.max(0, totalMonths - monthsElapsed);
                
            } else if (actualCurrentDate < startDate) {
                // Target period hasn't started yet
                monthsElapsed = 0;
                monthsRemaining = totalMonths;
            } else {
                // Target period has ended
                monthsElapsed = totalMonths;
                monthsRemaining = 0;
            }
            
            const progressPercentage = totalMonths > 0 ? (monthsElapsed / totalMonths) * 100 : 0;
            
            // Calculate cumulative sales for each rep in target period
            const targetProgress = {};
            
            Object.keys(halfYearTargets).forEach(salesRep => {
                if (salesRep === 'period' || salesRep === 'startMonth' || salesRep === 'endMonth') return;
                
                const target = halfYearTargets[salesRep];
                const repData = summaryData.filter(item => 
                    item.salesRep === salesRep && 
                    item.month >= targetPeriodStart && 
                    item.month <= targetPeriodEnd
                );
                
                const actualSales = _.sumBy(repData, 'totalSales');
                const progressPercent = target > 0 ? (actualSales / target) * 100 : 0;
                const remaining = Math.max(0, target - actualSales);
                
                // Determine status
                let status = 'on-track';
                if (progressPercent > progressPercentage + 5) {
                    status = 'ahead';
                } else if (progressPercent < progressPercentage - 10) {
                    status = 'behind';
                }
                
                targetProgress[salesRep] = {
                    target: target,
                    actual: actualSales,
                    progressPercent: Math.round(progressPercent * 10) / 10,
                    remaining: remaining,
                    status: status,
                    monthsElapsed: Math.round(monthsElapsed * 10) / 10,
                    monthsRemaining: Math.round(monthsRemaining * 10) / 10,
                    timeProgressPercent: Math.round(progressPercentage * 10) / 10
                };
            });
            
            // Calculate team totals
            const totalTarget = Object.keys(halfYearTargets)
                .filter(key => key !== 'period' && key !== 'startMonth' && key !== 'endMonth')
                .reduce((sum, rep) => sum + halfYearTargets[rep], 0);
            
            const totalActual = Object.values(targetProgress)
                .reduce((sum, rep) => sum + rep.actual, 0);
            
            const totalProgressPercent = totalTarget > 0 ? (totalActual / totalTarget) * 100 : 0;
            const totalRemaining = Math.max(0, totalTarget - totalActual);
            
            let teamStatus = 'on-track';
            if (totalProgressPercent > progressPercentage + 5) {
                teamStatus = 'ahead';
            } else if (totalProgressPercent < progressPercentage - 10) {
                teamStatus = 'behind';
            }
            
            return {
                individual: targetProgress,
                team: {
                    target: totalTarget,
                    actual: totalActual,
                    progressPercent: Math.round(totalProgressPercent * 10) / 10,
                    remaining: totalRemaining,
                    status: teamStatus,
                    monthsElapsed: Math.round(monthsElapsed * 10) / 10,
                    monthsRemaining: Math.round(monthsRemaining * 10) / 10,
                    timeProgressPercent: Math.round(progressPercentage * 10) / 10
                }
            };
        }
        
        function displayTargetProgress(targetProgress) {
            const container = document.getElementById('targetsProgress');
            container.innerHTML = '';
            
            // Create wrapper for progress cards and speedometer
            const wrapper = document.createElement('div');
            wrapper.className = 'target-progress-wrapper';
            
            // Create container for target cards
            const cardsContainer = document.createElement('div');
            cardsContainer.className = 'target-cards-container';
            
            if (currentTab === 'team') {
                // Show team summary when "Team Total" tab is selected
                const teamSummary = document.createElement('div');
                teamSummary.className = 'team-summary';
                teamSummary.innerHTML = `
                    <h4>Team Performance Summary</h4>
                    <div class="target-metrics">
                        <div class="target-metric">
                            <div class="label">Team Target</div>
                            <div class="value">${formatCurrency(targetProgress.team.target)}</div>
                        </div>
                        <div class="target-metric">
                            <div class="label">Team Actual</div>
                            <div class="value">${formatCurrency(targetProgress.team.actual)}</div>
                        </div>
                        <div class="target-metric">
                            <div class="label">Team Progress</div>
                            <div class="value">${targetProgress.team.progressPercent}%</div>
                        </div>
                        <div class="target-metric">
                            <div class="label">Team Remaining</div>
                            <div class="value ${targetProgress.team.remaining > 0 ? 'negative' : 'positive'}">${formatCurrency(targetProgress.team.remaining)}</div>
                        </div>
                    </div>
                    
                    <div class="progress-bar-container">
                        <div class="progress-bar ${targetProgress.team.status}" style="width: ${Math.min(targetProgress.team.progressPercent, 100)}%"></div>
                        <div class="time-progress-indicator" style="left: ${Math.min(targetProgress.team.timeProgressPercent, 100)}%"></div>
                    </div>
                    <div class="progress-text">
                        ${targetProgress.team.timeProgressPercent}% of time elapsed - Overall performance is <strong style="text-transform: capitalize;">${targetProgress.team.status.replace('-', ' ')}</strong>
                    </div>
                `;
                
                cardsContainer.appendChild(teamSummary);
                
                // Create speedometer for team
                const speedometer = createSpeedometer(targetProgress.team);
                wrapper.appendChild(cardsContainer);
                wrapper.appendChild(speedometer);
                
            } else {
                // Show individual sales rep progress
                if (targetProgress.individual[currentTab]) {
                    const rep = targetProgress.individual[currentTab];
                    
                    const card = document.createElement('div');
                    card.className = 'target-card';
                    card.innerHTML = `
                        <div class="target-header">
                            <h3>${currentTab}</h3>
                        </div>
                        
                        <div class="target-metrics">
                            <div class="target-metric">
                                <div class="label">Target</div>
                                <div class="value">${formatCurrency(rep.target)}</div>
                            </div>
                            <div class="target-metric">
                                <div class="label">Actual</div>
                                <div class="value">${formatCurrency(rep.actual)}</div>
                            </div>
                            <div class="target-metric">
                                <div class="label">Progress</div>
                                <div class="value">${rep.progressPercent}%</div>
                            </div>
                            <div class="target-metric">
                                <div class="label">Remaining</div>
                                <div class="value ${rep.remaining > 0 ? 'negative' : 'positive'}">${formatCurrency(rep.remaining)}</div>
                            </div>
                        </div>
                        
                        <div class="progress-bar-container">
                            <div class="progress-bar ${rep.status}" style="width: ${Math.min(rep.progressPercent, 100)}%"></div>
                            <div class="time-progress-indicator" style="left: ${Math.min(rep.timeProgressPercent, 100)}%"></div>
                        </div>
                        <div class="progress-text">
                            ${rep.monthsElapsed.toFixed(1)} of 6 months elapsed (${rep.timeProgressPercent}% of time period)
                        </div>
                    `;
                    
                    cardsContainer.appendChild(card);
                    
                    // Create speedometer for individual rep
                    const speedometer = createSpeedometer(rep);
                    wrapper.appendChild(cardsContainer);
                    wrapper.appendChild(speedometer);
                }
            }
            
            container.appendChild(wrapper);
        }
        
        function createSpeedometer(progressData) {
            const speedometerContainer = document.createElement('div');
            speedometerContainer.className = 'speedometer-container';
            
            // Calculate performance ratio (how ahead/behind they are relative to time)
            const performanceRatio = progressData.timeProgressPercent > 0 ? 
                progressData.progressPercent / progressData.timeProgressPercent : 1;
            
            // Convert to speedometer position (0 = far behind, 0.5 = on track, 1 = far ahead)
            // Scale: 0.5-1.5 ratio maps to 0-1 speedometer position
            let speedometerPosition = Math.max(0, Math.min(1, (performanceRatio - 0.5) / 1.0 + 0.5));
            
            // Calculate needle angle (0 degrees = far left, 180 degrees = far right)
            const needleAngle = speedometerPosition * 180;
            
            // Determine status based on performance ratio
            let status = 'on-track';
            if (performanceRatio < 0.85) {
                status = 'behind';
            } else if (performanceRatio > 1.15) {
                status = 'ahead';
            }
            
            speedometerContainer.innerHTML = `
                <div class="speedometer-title">Performance Gauge</div>
                <div class="speedometer">
                    <svg width="160" height="80" viewBox="0 0 160 80">
                        <!-- Behind section (red) -->
                        <path d="M 20 70 A 60 60 0 0 1 80 10" class="speedometer-arc behind" />
                        <!-- On track section (yellow) -->
                        <path d="M 80 10 A 60 60 0 0 1 140 70" class="speedometer-arc on-track" />
                        <!-- Ahead section (green) - overlay on part of on-track -->
                        <path d="M 120 35 A 60 60 0 0 1 140 70" class="speedometer-arc ahead" />
                        
                        <!-- Needle (pointing straight up initially, will be rotated via CSS) -->
                        <line x1="80" y1="70" x2="80" y2="15" class="speedometer-needle" style="transform: rotate(${needleAngle - 90}deg)" />
                        
                        <!-- Center dot -->
                        <circle cx="80" cy="70" r="4" class="speedometer-center" />
                    </svg>
                </div>
                <div class="speedometer-labels">
                    <span>Behind</span>
                    <span>On Track</span>
                    <span>Ahead</span>
                </div>
                <div class="speedometer-status ${status}">
                    ${status.replace('-', ' ')} 
                    <div style="font-size: 0.8em; font-weight: normal; margin-top: 2px;">
                        ${performanceRatio.toFixed(2)}x expected
                    </div>
                </div>
            `;
            
            return speedometerContainer;
        }
        
        function calculateDiscountPercentage(data) {
            // Get current filter values for filtering raw transaction data
            const fyFilter = document.getElementById('fyFilter').value;
            const monthFilter = document.getElementById('monthFilter').value;
            
            // Filter raw transaction data based on current filters
            let filteredTransactions = rawTransactionData;
            
            // Apply tab filter (sales rep)
            if (currentTab !== 'team') {
                filteredTransactions = filteredTransactions.filter(row => row['Sales Rep'] === currentTab);
            }
            
            // Apply financial year filter
            if (fyFilter) {
                filteredTransactions = filteredTransactions.filter(row => row.FinancialYear === fyFilter);
            }
            
            // Apply month filter
            if (monthFilter) {
                filteredTransactions = filteredTransactions.filter(row => row.MonthYear === monthFilter);
            }
            
            // Calculate discretionary discounts - look in Product/Service column
            const discountTransactions = filteredTransactions.filter(row => 
                row['Product/Service'] && row['Product/Service'].toLowerCase().includes('discretionary discount')
            );
            
            const totalDiscounts = Math.abs(_.sumBy(discountTransactions, 'Amount'));
            
            // Calculate sales excluding discounts
            const salesTransactions = filteredTransactions.filter(row => 
                !(row['Product/Service'] && row['Product/Service'].toLowerCase().includes('discretionary discount')) &&
                row.Amount > 0
            );
            
            const totalSalesExcludingDiscounts = _.sumBy(salesTransactions, 'Amount');
            
            // Calculate discount percentage across all orders
            const overallDiscountPercentage = totalSalesExcludingDiscounts > 0 ? 
                (totalDiscounts / totalSalesExcludingDiscounts) * 100 : 0;
            
            // Calculate discount percentage on discounted orders only
            // First, identify which invoices/orders had discounts
            const discountedInvoiceNumbers = [...new Set(discountTransactions.map(row => row['No.']))];
            
            // Find sales transactions for those specific invoices
            const discountedOrderSales = salesTransactions.filter(row => 
                discountedInvoiceNumbers.includes(row['No.'])
            );
            
            const totalSalesFromDiscountedOrders = _.sumBy(discountedOrderSales, 'Amount');
            
            const discountedOrdersPercentage = totalSalesFromDiscountedOrders > 0 ? 
                (totalDiscounts / totalSalesFromDiscountedOrders) * 100 : 0;
            
            return {
                totalDiscounts: totalDiscounts,
                totalSalesExcludingDiscounts: totalSalesExcludingDiscounts,
                overallDiscountPercentage: overallDiscountPercentage,
                discountedOrdersPercentage: discountedOrdersPercentage,
                discountedOrderCount: discountedInvoiceNumbers.length
            };
        }
        
        function displayDashboard(data) {
            dashboardData = data;
            filteredData = data; // Initialize filtered data
            
            // Hide loading, show results
            document.getElementById('loading').style.display = 'none';
            document.getElementById('dashboardResults').style.display = 'block';
            
            // Populate filter dropdowns and set defaults
            // This will automatically apply the filters and update the display
            populateFilters(data);
        }
        
        function populateFilters(data) {
            const defaults = getCurrentDefaults();
            
            // Populate financial year filter and set default to current FY
            const fyFilter = document.getElementById('fyFilter');
            fyFilter.innerHTML = '<option value="">All Financial Years</option>';
            data.uniqueFYs.forEach(fy => {
                const option = document.createElement('option');
                option.value = fy;
                option.textContent = fy;
                if (fy === defaults.currentFY) {
                    option.selected = true;
                }
                fyFilter.appendChild(option);
            });
            
            // Set initial months based on current FY
            let availableMonths = data.uniqueMonths;
            if (defaults.currentFY && data.uniqueFYs.includes(defaults.currentFY)) {
                availableMonths = data.summaryData
                    .filter(item => item.financialYear === defaults.currentFY)
                    .map(item => item.month);
                availableMonths = [...new Set(availableMonths)].sort();
            }
            
            // Populate month filter and set default to current month if available
            populateMonthFilter(availableMonths, defaults.currentMonthYear);
            
            // Apply default filters after a short delay to ensure DOM is updated
            setTimeout(() => {
                applyFilters();
                // Initialize chart after filters are applied
                setTimeout(() => updateRolling6MonthChart(), 200);
            }, 100);
        }
        
        function populateMonthFilter(months, defaultMonth = null) {
            const monthFilter = document.getElementById('monthFilter');
            monthFilter.innerHTML = '<option value="">All Months</option>';
            
            let hasCurrentMonth = false;
            months.forEach(month => {
                const option = document.createElement('option');
                option.value = month;
                option.textContent = formatMonth(month);
                if (defaultMonth && month === defaultMonth) {
                    option.selected = true;
                    hasCurrentMonth = true;
                }
                monthFilter.appendChild(option);
            });
            
            // If current month is not available in the data, don't select anything
            if (defaultMonth && !hasCurrentMonth) {
                monthFilter.value = '';
            }
        }
        
        function onFYFilterChange() {
            const fyFilter = document.getElementById('fyFilter').value;
            
            // Get months that belong to selected FY
            let availableMonths = dashboardData.uniqueMonths;
            
            if (fyFilter) {
                availableMonths = dashboardData.summaryData
                    .filter(item => item.financialYear === fyFilter)
                    .map(item => item.month);
                availableMonths = [...new Set(availableMonths)].sort();
            }
            
            // Update month dropdown - don't auto-select current month when FY changes
            populateMonthFilter(availableMonths);
            
            // Apply filters
            applyFilters();
        }
        
        function applyFilters() {
            const fyFilter = document.getElementById('fyFilter');
            const monthFilter = document.getElementById('monthFilter');
            
            const fyFilterValue = fyFilter ? fyFilter.value : '';
            const monthFilterValue = monthFilter ? monthFilter.value : '';
            
            // Filter summary data
            let filteredSummaryData = dashboardData.summaryData;
            
            // Apply tab filter
            if (currentTab !== 'team') {
                filteredSummaryData = filteredSummaryData.filter(item => item.salesRep === currentTab);
            }
            
            if (fyFilterValue) {
                filteredSummaryData = filteredSummaryData.filter(item => item.financialYear === fyFilterValue);
            }
            
            if (monthFilterValue) {
                filteredSummaryData = filteredSummaryData.filter(item => item.month === monthFilterValue);
            }
            
            // Filter variance data
            let filteredVarianceData = dashboardData.varianceData;
            
            // Apply tab filter
            if (currentTab !== 'team') {
                filteredVarianceData = filteredVarianceData.filter(item => item.salesRep === currentTab);
            }
            
            if (fyFilterValue) {
                // For variance data, filter by current month's FY (previous month can be in different FY)
                filteredVarianceData = filteredVarianceData.filter(item => {
                    const currentDate = new Date(item.currentMonth + '-01');
                    return isDateInFY(currentDate, fyFilterValue);
                });
            }
            
            if (monthFilterValue) {
                // For variance data, filter by current month
                filteredVarianceData = filteredVarianceData.filter(item => item.currentMonth === monthFilterValue);
            }
            
            // Create filtered data object
            filteredData = {
                summaryData: filteredSummaryData,
                varianceData: filteredVarianceData,
                uniqueMonths: fyFilterValue || currentTab !== 'team' ? 
                    [...new Set(filteredSummaryData.map(item => item.month))].sort() : 
                    dashboardData.uniqueMonths,
                uniqueSalesReps: monthFilterValue || fyFilterValue ? 
                    [...new Set(filteredSummaryData.map(item => item.salesRep))].sort() : 
                    dashboardData.uniqueSalesReps,
                uniqueFYs: monthFilterValue || currentTab !== 'team' ?
                    [...new Set(filteredSummaryData.map(item => item.financialYear))].sort() :
                    dashboardData.uniqueFYs
            };
            
            // Update sticky indicator
            updateStickyIndicator();
            
            // Update display
            updateFilteredDisplay();
        }
        
        function clearFilters() {
            document.getElementById('fyFilter').value = '';
            document.getElementById('monthFilter').value = '';
            
            // Reset month filter to show all months
            populateMonthFilter(dashboardData.uniqueMonths);
            
            // Reapply filters with current tab
            applyFilters();
        }
        
        function setCurrentMonth() {
            const now = new Date();
            const currentMonthYear = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;
            const currentFY = getFinancialYear(now);
            
            // Check if current month exists in data
            if (dashboardData.uniqueMonths.includes(currentMonthYear)) {
                // Set financial year filter
                document.getElementById('fyFilter').value = currentFY;
                
                // Update month dropdown for the selected FY
                const availableMonths = dashboardData.summaryData
                    .filter(item => item.financialYear === currentFY)
                    .map(item => item.month);
                const uniqueMonths = [...new Set(availableMonths)].sort();
                populateMonthFilter(uniqueMonths);
                
                // Set month filter
                document.getElementById('monthFilter').value = currentMonthYear;
                
                // Apply filters
                applyFilters();
            } else {
                alert(`No data available for current month (${formatMonth(currentMonthYear)})`);
            }
        }
        
        function setPreviousMonth() {
            const now = new Date();
            const previousMonth = new Date(now.getFullYear(), now.getMonth() - 1, 1);
            const previousMonthYear = `${previousMonth.getFullYear()}-${String(previousMonth.getMonth() + 1).padStart(2, '0')}`;
            const previousFY = getFinancialYear(previousMonth);
            
            // Check if previous month exists in data
            if (dashboardData.uniqueMonths.includes(previousMonthYear)) {
                // Set financial year filter
                document.getElementById('fyFilter').value = previousFY;
                
                // Update month dropdown for the selected FY
                const availableMonths = dashboardData.summaryData
                    .filter(item => item.financialYear === previousFY)
                    .map(item => item.month);
                const uniqueMonths = [...new Set(availableMonths)].sort();
                populateMonthFilter(uniqueMonths);
                
                // Set month filter
                document.getElementById('monthFilter').value = previousMonthYear;
                
                // Apply filters
                applyFilters();
            } else {
                alert(`No data available for previous month (${formatMonth(previousMonthYear)})`);
            }
        }
        
        function updateFilteredDisplay() {
            // Remove any existing filter info
            const existingInfo = document.querySelector('.filtered-info');
            if (existingInfo) {
                existingInfo.remove();
            }
            
            // Add filter info if filters are applied
            const fyFilter = document.getElementById('fyFilter').value;
            const monthFilter = document.getElementById('monthFilter').value;
            
            if (fyFilter || monthFilter || currentTab !== 'team') {
                const filterInfo = document.createElement('div');
                filterInfo.className = 'filtered-info';
                let filterText = 'Filtered by: ';
                const filters = [];
                
                if (currentTab !== 'team') filters.push(`Sales Rep: ${currentTab}`);
                if (fyFilter) filters.push(`Financial Year: ${fyFilter}`);
                if (monthFilter) filters.push(`Month: ${formatMonth(monthFilter)}`);
                
                filterInfo.textContent = filterText + filters.join(', ');
                
                // Insert after filters section
                const filtersSection = document.querySelector('.section');
                filtersSection.parentNode.insertBefore(filterInfo, filtersSection.nextSibling);
            }
            
            // Update current period heading
            updateCurrentPeriodHeading();
            
            // Update summary cards
            createSummaryCards(filteredData);
            
            // Check if we should show target progress based on filtered data
            const showTargets = shouldShowTargetProgress(filteredData.summaryData);
            const targetSection = document.getElementById('targetProgressSection');
            
            if (showTargets) {
                targetSection.classList.remove('hidden');
                // Calculate target progress using ALL data (not filtered by month) but filtered by tab
                let targetCalculationData = dashboardData.summaryData;
                if (currentTab !== 'team') {
                    targetCalculationData = dashboardData.summaryData.filter(item => item.salesRep === currentTab);
                }
                const targetProgress = calculateTargetProgress(targetCalculationData);
                displayTargetProgress(targetProgress);
            } else {
                targetSection.classList.add('hidden');
            }
            
            // Update tables
            populatePerformanceTable(filteredData.summaryData);
            populateVarianceTable(filteredData.varianceData);
            
            // Update variance equations
            updateWaterfallCharts(filteredData.varianceData);
            
            // Update rolling 6-month chart
            updateRolling6MonthChart();
        }
        
        function calculateTeamVarianceData(varianceData) {
            // Group variance data by current month
            const monthGroups = _.groupBy(varianceData, 'currentMonth');
            const teamVarianceData = [];
            
            Object.keys(monthGroups).forEach(month => {
                const monthData = monthGroups[month];
                const previousMonth = monthData[0].previousMonth;
                
                // Calculate team totals for current and previous months
                const totalCurrentSales = _.sumBy(monthData, 'currentTotalSales');
                const totalPreviousSales = _.sumBy(monthData, 'previousTotalSales');
                const totalSalesVariance = _.sumBy(monthData, 'totalSalesVariance');
                const totalOrderCountVariance = _.sumBy(monthData, 'orderCountVariance');
                
                // Get actual order counts from the original summary data
                const currentMonthSummary = dashboardData.summaryData.filter(item => item.month === month);
                const previousMonthSummary = dashboardData.summaryData.filter(item => item.month === previousMonth);
                
                const teamCurrentOrderCount = _.sumBy(currentMonthSummary, 'orderCount');
                const teamPreviousOrderCount = _.sumBy(previousMonthSummary, 'orderCount');
                
                // Calculate team average order values
                const teamPreviousAvgOrderValue = teamPreviousOrderCount > 0 ? totalPreviousSales / teamPreviousOrderCount : 0;
                const teamCurrentAvgOrderValue = teamCurrentOrderCount > 0 ? totalCurrentSales / teamCurrentOrderCount : 0;
                const teamAvgOrderValueVariance = teamCurrentAvgOrderValue - teamPreviousAvgOrderValue;
                
                // Calculate variance components correctly for team
                const teamVarianceDueToOrderCount = totalOrderCountVariance * teamPreviousAvgOrderValue;
                const teamVarianceDueToAvgOrderValue = teamCurrentOrderCount * teamAvgOrderValueVariance;
                
                teamVarianceData.push({
                    salesRep: 'Team Total',
                    currentMonth: month,
                    previousMonth: previousMonth,
                    totalSalesVariance: Math.round(totalSalesVariance * 100) / 100,
                    orderCountVariance: totalOrderCountVariance,
                    avgOrderValueVariance: Math.round(teamAvgOrderValueVariance * 100) / 100,
                    varianceDueToOrderCount: Math.round(teamVarianceDueToOrderCount * 100) / 100,
                    varianceDueToAvgOrderValue: Math.round(teamVarianceDueToAvgOrderValue * 100) / 100,
                    previousTotalSales: Math.round(totalPreviousSales * 100) / 100,
                    currentTotalSales: Math.round(totalCurrentSales * 100) / 100
                });
            });
            
            return teamVarianceData.sort((a, b) => a.currentMonth.localeCompare(b.currentMonth));
        }
        
        function updateWaterfallCharts(varianceData) {
            const container = document.getElementById('waterfallChartsContainer');
            container.innerHTML = '';
            
            if (varianceData.length === 0) {
                container.innerHTML = '<p style="color: #666; text-align: center; padding: 20px; font-style: italic;">No variance data available for analysis</p>';
                return;
            }
            
            let dataToShow = varianceData;
            
            // If team tab is selected, calculate and show team totals
            if (currentTab === 'team') {
                dataToShow = calculateTeamVarianceData(varianceData);
            }
            
            dataToShow.forEach(row => {
                const equation = createVarianceEquation(row);
                container.appendChild(equation);
            });
        }
        
        function getRolling6MonthData() {
            // Get the last 6 months based on available data
            const allMonths = [...new Set(dashboardData.summaryData.map(item => item.month))].sort();
            const last6Months = allMonths.slice(-6);
            
            // Get current date for determining which month is "current"
            const now = new Date();
            const currentMonthYear = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;
            
            const chartData = [];
            
            last6Months.forEach(month => {
                let monthData = dashboardData.summaryData.filter(item => item.month === month);
                
                // Apply tab filter
                if (currentTab !== 'team') {
                    monthData = monthData.filter(item => item.salesRep === currentTab);
                }
                
                const totalSales = _.sumBy(monthData, 'totalSales');
                const totalOrders = _.sumBy(monthData, 'orderCount');
                const isCurrentMonth = month === currentMonthYear;
                
                chartData.push({
                    month: month,
                    totalSales: totalSales,
                    totalOrders: totalOrders,
                    isCurrentMonth: isCurrentMonth,
                    label: isCurrentMonth ? `${formatMonthShort(month)} (Current)` : formatMonthShort(month)
                });
            });
            
            return chartData;
        }
        
        function formatMonthShort(monthStr) {
            const [year, month] = monthStr.split('-');
            const date = new Date(year, month - 1);
            return date.toLocaleDateString('en-GB', { month: 'short', year: '2-digit' });
        }
        
        function updateRolling6MonthChart() {
            const chartData = getRolling6MonthData();
            
            // Update chart title based on current tab
            const chartTitle = document.getElementById('chartTitle');
            if (currentTab === 'team') {
                chartTitle.textContent = 'Rolling 6-Month Sales Trend - Team Total';
            } else {
                chartTitle.textContent = `Rolling 6-Month Sales Trend - ${currentTab}`;
            }
            
            // Find max value for scaling
            const maxSales = Math.max(...chartData.map(d => d.totalSales));
            const chartBarsContainer = document.getElementById('chartBars');
            const chartLabelsContainer = document.getElementById('chartLabels');
            
            // Clear existing content
            chartBarsContainer.innerHTML = '';
            chartLabelsContainer.innerHTML = '';
            
            if (maxSales === 0) {
                chartBarsContainer.innerHTML = '<div style="text-align: center; color: #666; padding: 50px;">No sales data available for chart period</div>';
                return;
            }
            
            chartData.forEach(data => {
                // Create bar
                const bar = document.createElement('div');
                bar.className = `chart-bar ${data.isCurrentMonth ? 'current-month' : ''}`;
                const heightPercent = (data.totalSales / maxSales) * 100;
                bar.style.height = `${Math.max(heightPercent, 2)}%`; // Minimum 2% height for visibility
                
                // Add value label on bar
                const valueLabel = document.createElement('div');
                valueLabel.className = 'chart-bar-value';
                valueLabel.textContent = data.totalSales > 0 ? formatCurrencyShort(data.totalSales) : 'Â£0';
                bar.appendChild(valueLabel);
                
                // Add click handler for drill-down
                if (data.totalSales > 0) {
                    bar.style.cursor = 'pointer';
                    bar.onclick = () => {
                        if (currentTab === 'team') {
                            showSummaryOrderDetailsForMonth(data.month);
                        } else {
                            showOrderDetails(currentTab, data.month);
                        }
                    };
                    bar.title = `Click to view orders for ${data.label}`;
                }
                
                chartBarsContainer.appendChild(bar);
                
                // Create label
                const label = document.createElement('div');
                label.className = `chart-label ${data.isCurrentMonth ? 'current' : ''}`;
                label.textContent = data.label;
                chartLabelsContainer.appendChild(label);
            });
        }
        
        function formatCurrencyShort(amount) {
            if (amount >= 1000000) {
                return 'Â£' + (amount / 1000000).toFixed(1) + 'M';
            } else if (amount >= 1000) {
                return 'Â£' + (amount / 1000).toFixed(0) + 'k';
            } else {
                return 'Â£' + amount.toFixed(0);
            }
        }
        
        function showSummaryOrderDetailsForMonth(month) {
            // Set filters to show specific month and apply
            const monthData = dashboardData.summaryData.find(item => item.month === month);
            if (monthData) {
                document.getElementById('fyFilter').value = monthData.financialYear;
                document.getElementById('monthFilter').value = month;
                
                // Update month dropdown
                const availableMonths = dashboardData.summaryData
                    .filter(item => item.financialYear === monthData.financialYear)
                    .map(item => item.month);
                const uniqueMonths = [...new Set(availableMonths)].sort();
                populateMonthFilter(uniqueMonths);
                document.getElementById('monthFilter').value = month;
                
                // Apply filters and then show modal
                applyFilters();
                setTimeout(() => showSummaryOrderDetails(), 100);
            }
        }
        
        function updateCurrentPeriodHeading() {
            const fyFilter = document.getElementById('fyFilter').value;
            const monthFilter = document.getElementById('monthFilter').value;
            const headingElement = document.getElementById('currentPeriodHeading');
            
            let headingText = '';
            
            if (monthFilter) {
                // Specific month selected
                headingText = formatMonth(monthFilter);
            } else if (fyFilter) {
                // Specific financial year selected, all months
                headingText = fyFilter + ' Total';
            } else {
                // No filters - showing all data
                headingText = 'All Data Overview';
            }
            
            headingElement.textContent = headingText;
        }
        
        function createSummaryCards(data) {
            const container = document.getElementById('summaryCards');
            container.innerHTML = '';
            
            // Calculate totals based on filtered data
            if (data.summaryData.length === 0) {
                container.innerHTML = '<div class="summary-card"><h3>No Data</h3><div class="value">No records match the selected filters</div></div>';
                return;
            }
            
            const totalSales = _.sumBy(data.summaryData, 'totalSales');
            const totalOrders = _.sumBy(data.summaryData, 'orderCount');
            const avgOrderValueOverall = totalOrders > 0 ? totalSales / totalOrders : 0;
            
            // Calculate discount percentage from raw transaction data
            const discountInfo = calculateDiscountPercentage(data);
            
            // Determine performance status for Total Sales
            let performanceStatus = 'default';
            
            try {
                const monthFilterElement = document.getElementById('monthFilter');
                const monthFilter = monthFilterElement ? monthFilterElement.value : '';
                
                if (monthFilter) {
                    // Get target for the specific month and current tab
                    const targetSalesRep = currentTab === 'team' ? 'team' : currentTab;
                    const monthlyTarget = getMonthlyTarget(targetSalesRep, monthFilter);
                    
                    if (monthlyTarget > 0) {
                        performanceStatus = getPerformanceStatus(totalSales, monthlyTarget);
                    }
                }
            } catch (error) {
                console.log('Error determining performance status:', error);
                performanceStatus = 'default';
            }
            
            const cards = [
                { title: 'Total Sales', value: formatCurrency(totalSales), class: `total-sales ${performanceStatus}` },
                { 
                    title: 'Orders & Average Value', 
                    value: `
                        <div style="display: flex; flex-direction: column; gap: 6px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="font-size: 0.7em; color: #666; font-weight: normal;">Orders:</span>
                                <span style="font-size: 1.4em;">${totalOrders.toLocaleString()}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="font-size: 0.7em; color: #666; font-weight: normal;">Avg Value:</span>
                                <span style="font-size: 1.2em;">${formatCurrency(avgOrderValueOverall)}</span>
                            </div>
                        </div>
                    `, 
                    class: 'secondary combined-metrics' 
                },
                { 
                    title: 'Discount Metrics', 
                    value: `
                        <div style="display: flex; flex-direction: column; gap: 4px;">
                            <div style="font-size: 0.7em; color: #666; font-weight: normal;">Overall Impact:</div>
                            <div style="font-size: 1.4em; margin-bottom: 8px;">${discountInfo.overallDiscountPercentage.toFixed(1)}%</div>
                            <div style="font-size: 0.7em; color: #666; font-weight: normal;">On Discounted Orders:</div>
                            <div style="font-size: 1.2em;">${discountInfo.discountedOrdersPercentage.toFixed(1)}%</div>
                        </div>
                    `, 
                    class: 'secondary discount-card' 
                }
            ];
            
            cards.forEach(card => {
                const cardDiv = document.createElement('div');
                cardDiv.className = `summary-card ${card.class}`;
                
                // Add click handler for total sales
                const clickHandler = card.class.includes('total-sales') ? 'onclick="showSummaryOrderDetails()" title="Click to view all orders"' : '';
                
                cardDiv.innerHTML = `
                    <h3>${card.title}</h3>
                    <div class="value" ${clickHandler}>${card.value}</div>
                `;
                container.appendChild(cardDiv);
            });
        }
        
        function populatePerformanceTable(summaryData) {
            const tbody = document.getElementById('performanceTableBody');
            tbody.innerHTML = '';
            
            if (summaryData.length === 0) {
                const tr = document.createElement('tr');
                tr.innerHTML = '<td colspan="5" style="text-align: center; color: #666; padding: 30px;">No data matches the selected filters</td>';
                tbody.appendChild(tr);
                return;
            }
            
            summaryData.forEach(row => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${row.salesRep}</td>
                    <td>${formatMonth(row.month)}</td>
                    <td class="number clickable-sales" onclick="showOrderDetails('${row.salesRep}', '${row.month}')">${formatCurrency(row.totalSales)}</td>
                    <td class="number">${row.orderCount}</td>
                    <td class="number">${formatCurrency(row.avgOrderValue)}</td>
                `;
                tbody.appendChild(tr);
            });
        }
        
        function populateVarianceTable(varianceData) {
            const tbody = document.getElementById('varianceTableBody');
            tbody.innerHTML = '';
            
            if (varianceData.length === 0) {
                const tr = document.createElement('tr');
                tr.innerHTML = '<td colspan="8" style="text-align: center; color: #666; padding: 30px;">No variance data available for the selected filters</td>';
                tbody.appendChild(tr);
                return;
            }
            
            let dataToShow = varianceData;
            
            // If team tab is selected, calculate and show team totals
            if (currentTab === 'team') {
                dataToShow = calculateTeamVarianceData(varianceData);
            }
            
            dataToShow.forEach(row => {
                const tr = document.createElement('tr');
                
                const formatVariance = (value) => {
                    const formatted = typeof value === 'number' ? 
                        (value >= 0 ? '+' : '') + (Math.abs(value) >= 1000 ? 
                            formatCurrency(value) : 
                            'Â£' + value.toFixed(2)) : 
                        value.toString();
                    return `<span class="${value >= 0 ? 'positive' : 'negative'}">${formatted}</span>`;
                };
                
                const formatOrderVariance = (value) => {
                    const formatted = (value >= 0 ? '+' : '') + value.toString();
                    return `<span class="${value >= 0 ? 'positive' : 'negative'}">${formatted}</span>`;
                };
                
                tr.innerHTML = `
                    <td>${row.salesRep}</td>
                    <td>${formatMonth(row.currentMonth)}</td>
                    <td>${formatMonth(row.previousMonth)}</td>
                    <td class="number">${formatVariance(row.totalSalesVariance)}</td>
                    <td class="number">${formatOrderVariance(row.orderCountVariance)}</td>
                    <td class="number">${formatVariance(row.avgOrderValueVariance)}</td>
                    <td class="number">${formatVariance(row.varianceDueToOrderCount)}</td>
                    <td class="number">${formatVariance(row.varianceDueToAvgOrderValue)}</td>
                `;
                tbody.appendChild(tr);
            });
        }
        
        // Load data from CSV file automatically
        window.addEventListener('load', function() {
            loadCSVFromFile();
        });
        
        async function loadCSVFromFile() {
            try {
                document.getElementById('loading').style.display = 'block';
                document.getElementById('error').style.display = 'none';
                
                // Check if Papa Parse is loaded
                if (typeof Papa === 'undefined') {
                    throw new Error('Papa Parse library failed to load');
                }
                
                const response = await fetch('sales-data.csv');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const csvData = await response.text();
                const processedData = parseAndProcessData(csvData);
                displayDashboard(processedData);
                
            } catch (error) {
                console.error('Error loading CSV file:', error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
                document.getElementById('error').innerHTML = `
                    <strong>Could not load sales-data.csv automatically.</strong><br>
                    Error: ${error.message}<br>
                    Please ensure the sales-data.csv file exists in the same directory.
                `;
                
                // Show fallback sample data
                showSampleData();
            }
        }
        
        function showSampleData() {
            const defaults = getCurrentDefaults();
            
            // Create sample raw transaction data for drill-down, including current month data
            rawTransactionData = [
                {"Sales Rep":"Adam Bell","Transaction date":"15/05/2025","No.":"INV-001","Name":"Customer A","Amount":60,"Type":"Invoice","Product/Service":"Vertical Blinds","Month":5,"Year":2025,"MonthYear":"2025-05","FinancialYear":"FY24/25"},
                {"Sales Rep":"Michael Bell","Transaction date":"10/03/2025","No.":"INV-002","Name":"Customer B","Amount":500,"Type":"Invoice","Product/Service":"Roller Blinds","Month":3,"Year":2025,"MonthYear":"2025-03","FinancialYear":"FY24/25"},
                {"Sales Rep":"Michael Bell","Transaction date":"15/03/2025","No.":"INV-003","Name":"Customer C","Amount":750,"Type":"Invoice","Product/Service":"Venetian Blinds","Month":3,"Year":2025,"MonthYear":"2025-03","FinancialYear":"FY24/25"},
                {"Sales Rep":"Michael Bell","Transaction date":"20/03/2025","No.":"INV-004","Name":"Customer D","Amount":650,"Type":"Invoice","Product/Service":"Roman Blinds","Month":3,"Year":2025,"MonthYear":"2025-03","FinancialYear":"FY24/25"},
                {"Sales Rep":"Michael Bell","Transaction date":"25/03/2025","No.":"INV-005","Name":"Customer E","Amount":527.5,"Type":"Invoice","Product/Service":"Wooden Blinds","Month":3,"Year":2025,"MonthYear":"2025-03","FinancialYear":"FY24/25"},
                {"Sales Rep":"Michael Bell","Transaction date":"26/03/2025","No.":"CM-001","Name":"Customer E","Amount":-27.5,"Type":"Credit Memo","Product/Service":"Discretionary Discount","Line Description":"Discount applied","Month":3,"Year":2025,"MonthYear":"2025-03","FinancialYear":"FY24/25"},
                {"Sales Rep":"Ria Wise","Transaction date":"05/03/2025","No.":"INV-006","Name":"Customer F","Amount":1200,"Type":"Invoice","Product/Service":"Motorized Blinds","Month":3,"Year":2025,"MonthYear":"2025-03","FinancialYear":"FY24/25"},
                {"Sales Rep":"Ria Wise","Transaction date":"08/03/2025","No.":"INV-007","Name":"Customer G","Amount":850,"Type":"Invoice","Product/Service":"Plantation Shutters","Month":3,"Year":2025,"MonthYear":"2025-03","FinancialYear":"FY24/25"},
                {"Sales Rep":"Ria Wise","Transaction date":"09/03/2025","No.":"CM-002","Name":"Customer G","Amount":-50,"Type":"Credit Memo","Product/Service":"Discretionary Discount","Line Description":"Volume discount","Month":3,"Year":2025,"MonthYear":"2025-03","FinancialYear":"FY24/25"},
                // July 2025 data (start of target period)
                {"Sales Rep":"Michael Bell","Transaction date":"01/07/2025","No.":"INV-008","Name":"Customer H","Amount":12500,"Type":"Invoice","Product/Service":"Commercial Blinds","Month":7,"Year":2025,"MonthYear":"2025-07","FinancialYear":"FY25/26"},
                {"Sales Rep":"Michael Bell","Transaction date":"05/07/2025","No.":"INV-009","Name":"Customer I","Amount":8750,"Type":"Invoice","Product/Service":"Blackout Blinds","Month":7,"Year":2025,"MonthYear":"2025-07","FinancialYear":"FY25/26"},
                {"Sales Rep":"Michael Bell","Transaction date":"15/07/2025","No.":"INV-010","Name":"Customer J","Amount":6200,"Type":"Invoice","Product/Service":"Vertical Blinds","Month":7,"Year":2025,"MonthYear":"2025-07","FinancialYear":"FY25/26"},
                {"Sales Rep":"Michael Bell","Transaction date":"16/07/2025","No.":"CM-003","Name":"Customer J","Amount":-200,"Type":"Credit Memo","Product/Service":"Discretionary Discount","Line Description":"Early payment discount","Month":7,"Year":2025,"MonthYear":"2025-07","FinancialYear":"FY25/26"},
                {"Sales Rep":"Ria Wise","Transaction date":"02/07/2025","No.":"INV-011","Name":"Customer K","Amount":18500,"Type":"Invoice","Product/Service":"Premium Shutters","Month":7,"Year":2025,"MonthYear":"2025-07","FinancialYear":"FY25/26"},
                {"Sales Rep":"Ria Wise","Transaction date":"10/07/2025","No.":"INV-012","Name":"Customer L","Amount":14750,"Type":"Invoice","Product/Service":"Motorized Curtains","Month":7,"Year":2025,"MonthYear":"2025-07","FinancialYear":"FY25/26"},
                {"Sales Rep":"Ria Wise","Transaction date":"20/07/2025","No.":"INV-013","Name":"Customer M","Amount":11200,"Type":"Invoice","Product/Service":"Roller Blinds","Month":7,"Year":2025,"MonthYear":"2025-07","FinancialYear":"FY25/26"},
                {"Sales Rep":"Ria Wise","Transaction date":"21/07/2025","No.":"CM-004","Name":"Customer M","Amount":-400,"Type":"Credit Memo","Product/Service":"Discretionary Discount","Line Description":"Customer loyalty discount","Month":7,"Year":2025,"MonthYear":"2025-07","FinancialYear":"FY25/26"}
            ];
            
            const sampleData = {
                summaryData: [
                    {"salesRep":"Adam Bell","month":"2025-05","financialYear":"FY24/25","totalSales":60,"orderCount":1,"avgOrderValue":60},
                    {"salesRep":"Michael Bell","month":"2025-03","financialYear":"FY24/25","totalSales":2427.5,"orderCount":4,"avgOrderValue":606.88},
                    {"salesRep":"Michael Bell","month":"2025-04","financialYear":"FY24/25","totalSales":9241.08,"orderCount":11,"avgOrderValue":840.1},
                    {"salesRep":"Michael Bell","month":"2025-05","financialYear":"FY24/25","totalSales":9462.5,"orderCount":12,"avgOrderValue":788.54},
                    {"salesRep":"Michael Bell","month":"2025-06","financialYear":"FY24/25","totalSales":21035.99,"orderCount":19,"avgOrderValue":1107.16},
                    {"salesRep":"Michael Bell","month":"2025-07","financialYear":"FY25/26","totalSales":27450,"orderCount":3,"avgOrderValue":9150},
                    {"salesRep":"Ria Wise","month":"2025-03","financialYear":"FY24/25","totalSales":13009.17,"orderCount":14,"avgOrderValue":929.23},
                    {"salesRep":"Ria Wise","month":"2025-04","financialYear":"FY24/25","totalSales":17413.32,"orderCount":18,"avgOrderValue":967.41},
                    {"salesRep":"Ria Wise","month":"2025-05","financialYear":"FY24/25","totalSales":15460.86,"orderCount":15,"avgOrderValue":1030.72},
                    {"salesRep":"Ria Wise","month":"2025-06","financialYear":"FY24/25","totalSales":23631.65,"orderCount":21,"avgOrderValue":1125.32},
                    {"salesRep":"Ria Wise","month":"2025-07","financialYear":"FY25/26","totalSales":44450,"orderCount":3,"avgOrderValue":14816.67}
                ],
                varianceData: [
                    {"salesRep":"Michael Bell","currentMonth":"2025-04","previousMonth":"2025-03","totalSalesVariance":6813.58,"orderCountVariance":7,"avgOrderValueVariance":233.22,"varianceDueToOrderCount":4248.16,"varianceDueToAvgOrderValue":2565.42,"previousTotalSales":2427.5,"currentTotalSales":9241.08},
                    {"salesRep":"Michael Bell","currentMonth":"2025-05","previousMonth":"2025-04","totalSalesVariance":221.42,"orderCountVariance":1,"avgOrderValueVariance":-51.56,"varianceDueToOrderCount":840.1,"varianceDueToAvgOrderValue":-618.72,"previousTotalSales":9241.08,"currentTotalSales":9462.5},
                    {"salesRep":"Michael Bell","currentMonth":"2025-06","previousMonth":"2025-05","totalSalesVariance":11573.49,"orderCountVariance":7,"avgOrderValueVariance":318.62,"varianceDueToOrderCount":5519.78,"varianceDueToAvgOrderValue":6053.78,"previousTotalSales":9462.5,"currentTotalSales":21035.99},
                    {"salesRep":"Michael Bell","currentMonth":"2025-07","previousMonth":"2025-06","totalSalesVariance":6414.01,"orderCountVariance":-16,"avgOrderValueVariance":8042.84,"varianceDueToOrderCount":-17714.56,"varianceDueToAvgOrderValue":24128.52,"previousTotalSales":21035.99,"currentTotalSales":27450},
                    {"salesRep":"Ria Wise","currentMonth":"2025-04","previousMonth":"2025-03","totalSalesVariance":4404.15,"orderCountVariance":4,"avgOrderValueVariance":38.18,"varianceDueToOrderCount":3716.92,"varianceDueToAvgOrderValue":687.24,"previousTotalSales":13009.17,"currentTotalSales":17413.32},
                    {"salesRep":"Ria Wise","currentMonth":"2025-05","previousMonth":"2025-04","totalSalesVariance":-1952.46,"orderCountVariance":-3,"avgOrderValueVariance":63.31,"varianceDueToOrderCount":-2902.23,"varianceDueToAvgOrderValue":949.65,"previousTotalSales":17413.32,"currentTotalSales":15460.86},
                    {"salesRep":"Ria Wise","currentMonth":"2025-06","previousMonth":"2025-05","totalSalesVariance":8170.79,"orderCountVariance":6,"avgOrderValueVariance":94.6,"varianceDueToOrderCount":6184.32,"varianceDueToAvgOrderValue":1986.6,"previousTotalSales":15460.86,"currentTotalSales":23631.65},
                    {"salesRep":"Ria Wise","currentMonth":"2025-07","previousMonth":"2025-06","totalSalesVariance":20818.35,"orderCountVariance":-18,"avgOrderValueVariance":13691.35,"varianceDueToOrderCount":-20255.76,"varianceDueToAvgOrderValue":41074.1,"previousTotalSales":23631.65,"currentTotalSales":44450}
                ],
                uniqueMonths: ["2025-03","2025-04","2025-05","2025-06","2025-07"],
                uniqueSalesReps: ["Adam Bell","Michael Bell","Ria Wise"],
                uniqueFYs: ["FY24/25","FY25/26"]
            };
            
            displayDashboard(sampleData);
        }
    </script>
</body>
</html>
